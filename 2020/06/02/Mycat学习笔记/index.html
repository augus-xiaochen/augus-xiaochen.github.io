<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"8.0.0-rc.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="MyCat是目前最流行的基于Java语言编写的数据库中间件，是一个实现了MySql协议的服务器，其核心功能是分库分表。配合数据库的主从模式还可以实现读写分离。一个彻底开源的，面向企业应用开发的大数据库集群 支持事务、ACID、可以替代MySQL的加强版数据库 一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群 一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Mycat学习笔记">
<meta property="og:url" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="晓晨の博客">
<meta property="og:description" content="MyCat是目前最流行的基于Java语言编写的数据库中间件，是一个实现了MySql协议的服务器，其核心功能是分库分表。配合数据库的主从模式还可以实现读写分离。一个彻底开源的，面向企业应用开发的大数据库集群 支持事务、ACID、可以替代MySQL的加强版数据库 一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群 一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image003.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image005.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image007.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image009.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image011.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image013.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image015.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image017.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image019.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image021.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image023.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image025.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image027.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image029.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image031.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image033.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image035.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image037.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image039.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image041.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image043.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image045.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image047.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image049.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image051.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image053.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image055.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image057.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image059.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image061.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image063.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image065.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image067.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image069.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image071.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image073.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image075.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image077.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image079.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image081.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image083.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image085.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image087.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image089.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image091.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image093.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image095.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image097.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image099.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image101.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image103.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image105.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image107.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/mycat%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%20clip_image109.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image111.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image113.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image115.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image117.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image119.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image121.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image123.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image125.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image127.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image129.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image131.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image133.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image135.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image137.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image139.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image141.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image143.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image145.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image147.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image149.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image151.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image153.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image155.gif">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image157.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image159.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image161.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image163.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image165.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image167.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image169.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image171.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image173.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image175.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image177.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image179.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image181.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image183.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image185.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image187.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image189.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image191.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image193.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image195.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image197.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image199.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image201.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image203.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image205.jpg">
<meta property="og:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image207.jpg">
<meta property="article:published_time" content="2020-06-02T05:31:19.000Z">
<meta property="article:modified_time" content="2020-06-02T05:49:13.713Z">
<meta property="article:author" content="晓晨">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image003.jpg">

<link rel="canonical" href="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Mycat学习笔记 | 晓晨の博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">晓晨の博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">7</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="晓晨">
      <meta itemprop="description" content="乱世浮尘，不堪遥望，唯有情意，晨光依旧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晓晨の博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mycat学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-02 13:31:19 / 修改时间：13:49:13" itemprop="dateCreated datePublished" datetime="2020-06-02T13:31:19+08:00">2020-06-02</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>MyCat是目前最流行的<strong>基于Java语言编写</strong>的<strong>数据库中间件</strong>，是一个实现了MySql协议的服务器，其核心功能是<strong>分库分表</strong>。配合数据库的主从模式还可以实现<strong>读写分离</strong>。一个彻底开源的，面向企业应用开发的大数据库集群</p>
<p>支持事务、ACID、可以替代MySQL的加强版数据库</p>
<p>一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群</p>
<p>一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server</p>
<p>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品</p>
<p>一个新颖的数据库中间件产品</p>
<a id="more"></a>



<h1 id="第一节：Mycat基础"><a href="#第一节：Mycat基础" class="headerlink" title="第一节：Mycat基础"></a>第一节：Mycat基础</h1><h2 id="1-Mycat作用"><a href="#1-Mycat作用" class="headerlink" title="1.        Mycat作用"></a>1.        Mycat作用</h2><p>l  读写分离（MM-SS高可用）</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image003.jpg" alt="img"></p>
<p>l  数据分片（数据库分布式）</p>
<p>垂直拆分（分库）——将一个database拆分为多个，分别存在多个MySQL主机中</p>
<p>水平拆分（分表）——将一个tables拆分为多个，分别存在多个MySQL主机中</p>
<p>垂直+水平拆分（分库分表）</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image005.jpg" alt="img"></p>
<p>l  多数据源整合</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image007.jpg" alt="img"></p>
<h2 id="1-Mycat原理"><a href="#1-Mycat原理" class="headerlink" title="1.        Mycat原理"></a>1.        Mycat原理</h2><p>Mycat的原理中最重要的一个动词是“拦截”，它拦截了用户发送过来的SQL语句，首先对SQL语句做了一些特定的分析：如分片分析、路由分析、读写分离分析、缓存分析等，然后将此SQL发往后端的真实数据库，并将返回的结果做适当的处理，最终再返回给用户。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image009.jpg" alt="img"></p>
<p>这种方式把数据库的分布式从代码中解耦出来，程序员察觉不出来后台使用 Mycat还是MySQL。</p>
<h2 id="1-Mycat部署"><a href="#1-Mycat部署" class="headerlink" title="1.        Mycat部署"></a>1.        Mycat部署</h2><p>l  源码安装Mycat</p>
<p>tar –zxvf Mycat-server.xxxxxxx –C /usr/local/</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image011.jpg" alt="img"></p>
<p>l  三个配置文件</p>
<p>l schema.xml：定义逻辑库、表、分片节点等内容</p>
<p>l rule.xml：定义分片规则</p>
<p>l server.xml：定义用户及系统相关变量，如端口等</p>
<p>l  修改Mycat配置文件</p>
<p>l  修改server.xml</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image013.jpg" alt="img"></p>
<p>l  修改schema.xml</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image015.gif" alt="img"></p>
<p>l  验证MySQL连接性</p>
<p>mysql –h mysqlm1 –uroot –p123123 –P3306</p>
<p>mysql –h mysqls1 –uroot –p123123 –P3306</p>
<p>l  启动Mycat</p>
<p>控制台启动：去 mycat/bin目录下执行. Mycat console </p>
<p>后台启动：去 mycat/bin目录下. Mycat start</p>
<p>##为了能第一时间看到启动日志，方便定位问题，我们选择①控制台启动。</p>
<p>l  登录Mycat</p>
<p>l  后台管理登录：此登录方式用户维护管理，端口9066</p>
<p>Mysql –umycat -p123456 -P9066 -h192.168.140.128</p>
<p>l  数据窗口登录</p>
<p>Mysql –umycat -p123456 -P8066 -h192.168.140.128</p>
<h1 id="第二节：Mycat读写分离"><a href="#第二节：Mycat读写分离" class="headerlink" title="第二节：Mycat读写分离"></a>第二节：Mycat读写分离</h1><p>  Mycat读写分体的前提是MySQL先要实现主从复制功能</p>
<p>我们通过 Mycat 和 MYSQL 的主从复制配合搭建数据库的读写分离，实现 MYSQL 的高可用性。我们将搭建：一主一从、双主双从两种读写分离模式</p>
<h2 id="2-1-一主一从MySQL读写分离"><a href="#2-1-一主一从MySQL读写分离" class="headerlink" title="2-1. 一主一从MySQL读写分离"></a>2-1. 一主一从MySQL读写分离</h2><p>l  MySQL主从配置</p>
<p>l  修改MySQL-Master主机my.cnf文件</p>
<p>l  <font color="green" size="5">#主服务器唯一ID </font></p>
<p>server-id=1</p>
<p>l  #并启用二进制日志 </p>
<p>log-bin=mysql-bin</p>
<p>l  #设置不要复制的数据库（可设置多个，默认是MySQL中的4个初始数据库）</p>
<p>binlog-ignore-db=mysql</p>
<p>binlog-ignore-db=information_schema。</p>
<p>l  #设置需要复制的数据库</p>
<p>binlog-do-db=需要复制的主数据库名字</p>
<p>l  #设置 hogbin 格式</p>
<p>binlog format=STATEMENT、ROW、MIXED</p>
<p>l  STATEMENT：记录操作时间，同一时间可能存在多条语句，会在成数据不一致</p>
<p>l  ROW：记录操作行，一条语句可能执行上万条操作（比如update），会造成记录内容庞大、复杂</p>
<p>l  MIXED：对STATEMENT和ROW自主选择最佳的方式进行记录；缺点：无法获取当前主机名称@@host name函数</p>
<p>l  修改MySQL-Slave主机my.cnf文件</p>
<p>l  #从服务器唯一 ID</p>
<p>server-id=2.</p>
<p>l  #启用中继日志 </p>
<p>relay-log=mysql-relay</p>
<p>l  在Master主机授权Slave访问账户</p>
<p>GRANT REPLICATION SLAVE ON <em>.</em> TO ‘slave’ @’%’ IDENTIFIED BY ‘123123’;</p>
<p>l  查询Master状态：show master status；</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image017.gif" alt="img"></p>
<p>l  从机Slave角色配置</p>
<p>l  stop slave;</p>
<p>l  reset master;</p>
<p>l  CHANGE MASTER TO MASTER HOST=’主机的IP地址,</p>
<p>MASTER USER=’SLAVE’,</p>
<p>MASTER PASSWORD=123123,</p>
<p>MASTER LOG_FILE=’ mysql-bin.具体数字，MASTER LOG_POS=具体值；</p>
<p>l  start slave;</p>
<p>l  show slave status\G</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image019.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image021.gif" alt="img"></p>
<p>l  创建相关实验用库、表（步骤省略，详细回顾MySQL笔记）</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image023.gif" alt="img"></p>
<p>l  Mycat一主一从读写分离实现</p>
<p>/usr/local/mycat/bin/mycat console （控制台启动）</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image025.gif" alt="img"></p>
<p>l  修改schema.xml文件<DataHost>的balance属性</DataHost></p>
<p>l  balance=”0”:不开启读写分离机制，所有读操作都发送到当前可用的 writehost 上。</p>
<p>l  balance=”1”:全部的 readhost 与 stand by writehost 参与 select 语句的负载均衡，简单的说，当双主双从模式（M1-&gt; S1, M2-&gt; S2, 并且 M1 与 M2 互为主备），正常情况下，M2、S1、S2 都参与 select 语句的负载均衡。</p>
<p>l  balance=”2”:所有读操作都随机的在 writehost、readhost 上分发。</p>
<p>l  balance=”3”:所有读请求随机的分发到 readhost 执行，writerhost 不负担读压力</p>
<h2 id="2-2-多主多从MySQL读写分离"><a href="#2-2-多主多从MySQL读写分离" class="headerlink" title="2-2. 多主多从MySQL读写分离"></a>2-2. 多主多从MySQL读写分离</h2><p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image027.gif" alt="img"></p>
<p>l  多主多从MySQL配置</p>
<p>l <strong>Master1</strong>的my.cnf文件配置</p>
<p>l  #主服务器唯一ID </p>
<p>server-id=1</p>
<p>l  #并启用二进制日志 </p>
<p>log-bin=mysql-bin</p>
<p>l  #设置不要复制的数据库（可设置多个，默认是MySQL中的4个初始数据库）</p>
<p>binlog-ignore-db=mysql</p>
<p>binlog-ignore-db=information_schema。</p>
<p>l  #设置需要复制的数据库</p>
<p>binlog-do-db=需要复制的主数据库名字</p>
<p>l  #设置 hogbin 格式</p>
<p>binlog format=STATEMENT、ROW、MIXED</p>
<p>l  #在作为从数据库的时候，有写入操作也要更新二进制日志文件。</p>
<p>log-slave-updates</p>
<p>l  #表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1，取值范围是 1-65535</p>
<p>auto-increment-increment=2</p>
<p>l  #表示自增长字段从哪个数开始，指字段一次递増多少，他的取值范围是1-65535</p>
<p>auto-increment-offset=1</p>
<p>l <strong>Master2**</strong>的my.cnf文件配置**</p>
<p>l  #主服务器唯一ID </p>
<p>server-id=1</p>
<p>l  #并启用二进制日志 </p>
<p>log-bin=mysql-bin</p>
<p>l  #设置不要复制的数据库（可设置多个，默认是MySQL中的4个初始数据库）</p>
<p>binlog-ignore-db=mysql</p>
<p>binlog-ignore-db=information_schema。</p>
<p>l  #设置需要复制的数据库</p>
<p>binlog-do-db=需要复制的主数据库名字</p>
<p>l  #设置 hogbin 格式</p>
<p>binlog format=STATEMENT、ROW、MIXED</p>
<p>l  #在作为从数据库的时候，有写入操作也要更新二进制日志文件。</p>
<p>log-slave-updates</p>
<p>l  #表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1，取值范围是 1-65535</p>
<p>auto-increment-increment=2</p>
<p>l  #表示自增长字段从哪个数开始，指字段一次递増多少，他的取值范围是1-65535</p>
<p>auto-increment-offset=2（同Master1存在区别，不能重复）</p>
<p>l Slave1和Slave2的my.cnf配置</p>
<p>l  #从服务器唯一 ID</p>
<p>server-id=2.</p>
<p>l  #启用中继日志 </p>
<p>relay-log=mysql-relay</p>
<p>l  在Master为Slave创建授权用户</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image029.gif" alt="img"></p>
<p>l <strong>Master1—Slave1**</strong>、Master2—Slave2主从配置**</p>
<p>l  Slave1角色配置</p>
<p>CHANGE· MASTER・TO</p>
<p>MASTER HOST=’Master1’,</p>
<p>MASTER_USER=’SLAVE’, </p>
<p>MASTER PASSWORD= ‘123123’,</p>
<p>MASTER_LOG_FILE=’MYSAL-BIN.000001, MASTE R LOG POS=154’;</p>
<p>l  Slave2角色配置</p>
<p>CHANGE· MASTER・TO</p>
<p>MASTER HOST=’Master2’,</p>
<p>MASTER_USER=’SLAVE’,</p>
<p>MASTER PASSWORD= ‘123123’,</p>
<p>MASTER_LOG_FILE=’MYSAL-BIN.000001, MASTE R LOG POS=154’;</p>
<p>l  <strong>Master1**</strong>和Master2相互复制配置**</p>
<p>l  Master1角色配置</p>
<p>CHANGE· MASTER・TO</p>
<p>MASTER HOST=’Master2’,</p>
<p>MASTER_USER=’SLAVE’,</p>
<p>MASTER PASSWORD= ‘123123’,</p>
<p>MASTER_LOG_FILE=’MYSAL-BIN.000001, MASTE R LOG POS=154’;</p>
<p>l  Master2角色配置</p>
<p>CHANGE· MASTER・TO</p>
<p>MASTER HOST=’Master1’,</p>
<p>MASTER_USER=’SLAVE’,</p>
<p>MASTER PASSWORD= ‘123123’,</p>
<p>MASTER_LOG_FILE=’MYSAL-BIN.000001, MASTE R LOG POS=154’;</p>
<p><strong>##</strong>总结：Slave1配置Master1、Slave2配置Master2、Master1配置Master2、Master2配置Master1**</p>
<p><strong>##</strong>：Slave1对应Master1、Slave2对应Master2、Master1和Master2互相对应**</p>
<p>l  <strong>创建本实验所需库、表（省略）</strong></p>
<p>l <strong>Mycat</strong>实现多主多从读写分离</p>
<p>l <strong>编辑Mycat—schema.xml文件<DataHost>字段balance属性</DataHost></strong></p>
<p>l balance=”1”</p>
<p>全部的 readhost 与 stand by writehost 参与 select 语句的负载均衡，简单的说，当双主双从模式（M1-&gt; S1, M2-&gt; S2, 并且 M1 与 M2 互为主备），正常情况下，M2、S1、S2 都参与 select 语句的负载均衡</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image031.gif" alt="img"></p>
<p>l  Write Type=”O：所有写操作发送到配置的第一个 writehost，第一个挂了切到还生存的第二个 </p>
<p>l  write Type=”1“，所有写操作都随机的发送到配置的writehost；1.5 以后废弃不推荐 </p>
<p>l  writehost，重新启动后以切换后的为准，切换记录在配置文件中 dnindex properties </p>
<p>l  switchtype=”1”:</p>
<p>​    1 默认值，自动切换</p>
<p>​    -1 表示不自动切换</p>
<p>2 基于 MYSQL 主从同步的状态决定是否切换</p>
<p>l  启动Mycat测试读写分离</p>
<p>#在写主机 Master 数据库表 myth1表中插入带系统变量数据，造成主从数据不一致</p>
<p>  INSERT INTO mytb1 VALUES (2, @@hostname);</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image033.gif" alt="img">     <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image035.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image037.gif" alt="img">    <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image039.gif" alt="img">)<img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image041.gif" alt="img"></p>
<p>##通过在Mycat多次的select * from mytbl; 通过观察返回表中的主机名判断读写主机</p>
<p>l  通过Mycat实现MySQL高可用测试</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image043.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image045.gif" alt="img"></p>
<h1 id="第三节：垂直拆分——分库"><a href="#第三节：垂直拆分——分库" class="headerlink" title="第三节：垂直拆分——分库"></a>第三节：垂直拆分——分库</h1><p>一个数据库由很多表的构成，每个表对应着不同的业务，垂直切分是指按照业务将表进行分类，分布到不同的数据库上面，这样也就将数据或者说压力分担到不同的库上面，如下图：</p>
<p> <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image047.gif" alt="img"></p>
<p>l Mycat分库配置</p>
<p>l <strong>实验所需资料</strong></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image049.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image051.gif" alt="img"></p>
<p>l <strong>编辑schema.xml文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"TESTDB"</span> <span class="attr">checkSQLschema</span>=<span class="string">"false"</span> <span class="attr">sqlMaxLimit</span>=<span class="string">"100"</span> <span class="attr">dataNode</span>=<span class="string">"dn1"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span> &gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn1"</span> <span class="attr">dataHost</span>=<span class="string">"host1"</span> <span class="attr">database</span>=<span class="string">"orders"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn2"</span> <span class="attr">dataHost</span>=<span class="string">"host2"</span> <span class="attr">database</span>=<span class="string">"orders"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"host1"</span> <span class="attr">maxCon</span>=<span class="string">"1000"</span> <span class="attr">minCon</span>=<span class="string">"10"</span> <span class="attr">balance</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">writeType</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span> <span class="attr">switchType</span>=<span class="string">"1"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">slaveThreshold</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- can have multi write hosts --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"hostM1"</span> <span class="attr">url</span>=<span class="string">"192.168.140.128:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">password</span>=<span class="string">"123123"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"host2"</span> <span class="attr">maxCon</span>=<span class="string">"1000"</span> <span class="attr">minCon</span>=<span class="string">"10"</span> <span class="attr">balance</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">writeType</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span> <span class="attr">switchType</span>=<span class="string">"1"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">slaveThreshold</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- can have multi write hosts --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"hostM2"</span> <span class="attr">url</span>=<span class="string">"192.168.140.127:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">password</span>=<span class="string">"123123"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image053.gif" alt="img"></p>
<p>##此时读写分离已经没必要了，balance=0</p>
<p>l <strong>新增空白orders数据库</strong></p>
<p>分库操作不是在原来的老数据库上进行操作，需要准备两台机器分别安装新的数据库并在数据节点 dnl、dn2 上分别创建数据库 orders。在不同的主机上创建相同名称的库</p>
<p>CREATE DATABASE orders;</p>
<p>##Mycat通过拦截SQL语句，判断是访问客户表，还是其他表，然后再次进行分配</p>
<p>##Mycat根据数据库名称进行识别，将访问不同的表的请求，转发到不同机器的orders库</p>
<p>l <strong>Mycat**</strong>分库实现测试**</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image055.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image057.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image059.gif" alt="img"></p>
<p>##因为之前在Mycat的schema.xml配置<table name="customer" datanode="dn2"></table></p>
<p>l  再次在Mycat创建剩余三张表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image061.gif" alt="img"></p>
<p>##将建库建表等操作在Mycat上进行，由Mycat根据不同策略进行分配数据主机，实现数据分库</p>
<h1 id="第四节：水平拆分——分表"><a href="#第四节：水平拆分——分表" class="headerlink" title="第四节：水平拆分——分表"></a>第四节：水平拆分——分表</h1><h2 id="4-1-水平分表划分原则"><a href="#4-1-水平分表划分原则" class="headerlink" title="4-1. 水平分表划分原则"></a>4-1. 水平分表划分原则</h2><p>相对于垂直拆分，水平拆分不是将表做分类，而是按照某个字段的某种规则来分散到多个库之中每个表中包含一部分数据。简单来说，我们可以将数据的水平切分理解为是按照数据行的切分，就是将表中的某些行切分到一个数据库，而另外的某些行又切分到其他的数据库中，如图：</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image063.gif" alt="https://img-blog.csdnimg.cn/2020030123193198.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JvYmluc29uXzkxMQ==,size_16,color_FFFFFF,t_70"></p>
<p>l  配置分表</p>
<p>Ø 选择要拆分的表</p>
<p>MySQL单表存储数据条数是有瓶颈的，单表达到1000万条数据就达到了瓶颈，会影响查询效率需要进行水平拆分（分表）进行优化</p>
<p>例如：例子中的 orders、 orders detail都已经达到600万行数据，需要进行分表优化</p>
<p>Ø 选择分表字段</p>
<p>以 orders 表（表结构语句如下面）为例，可以根据不同字段进行分表</p>
<p>CREATE TABLE orders（</p>
<p>id INT AUTO_INCREMENT,</p>
<p>order_type INT.</p>
<p>customer_id INT.</p>
<p>amount DECIMAL(10,2),</p>
<p>PRIMARY KEY(id),</p>
<p>);</p>
<blockquote>
<blockquote>
<p>id(主键、或创建时间)  查询订单注重时效，历史订单被查询的次数少，如此分片会造成一个节点访问多，一个访问少，不平均。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>customer_id(客户 id)  根据客户 id 去分，两个节点访问平均，一个客户的所 有订单都在同一个节点。故此处选择它来分表。</p>
</blockquote>
</blockquote>
<h2 id="4-2-水平分表配置"><a href="#4-2-水平分表配置" class="headerlink" title="4-2. 水平分表配置"></a>4-2. 水平分表配置</h2><p>l  Mycat配置水平分表</p>
<p>Ø 配置schema.xml文件</p>
<blockquote>
<blockquote>
<p>为 orders表设置数据节点为dn1、dn2，并指定分片规则为 mod rule（自定义的名字）</p>
</blockquote>
</blockquote>
<table name="orders"" datanode="”dnl," dn2” rule="mod_rule"></table>

<p>Ø 配置rule.xml文件</p>
<blockquote>
<blockquote>
<p>在rule配置文件里新增分片规则 mod rule，并指定规则适用字段为 customer_id</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>选择分片算法 mod-Iong（对字段求模运算）， customer_id对两个节点求模，根据结果分片</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>配置算法mod-long参数 count为2，两个节点</p>
</blockquote>
</blockquote>
<tableRule name="mod rule">

<rule>

<p><columns>customer_id</columns>.</p>
<p><algorithm>mod-long</algorithm></p>
</rule>

</tableRule>

<p>##配置分片规则、指定适应字段、选择分片算法</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image065.jpg" alt="img"></p>
<p>##配置算法mod-long参数，count为2</p>
<p>Ø 在dn2数据上补充创建orders表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image067.jpg" alt="img"></p>
<p>Ø 重启Mycat验证分片效果</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image069.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image071.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p> 在dn1和dn2上面进行数据查询</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image073.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image075.jpg" alt="img"></p>
<h2 id="4-3-Mycat分片关联—ER表"><a href="#4-3-Mycat分片关联—ER表" class="headerlink" title="4-3. Mycat分片关联—ER表"></a>4-3. Mycat分片关联—ER表</h2><p>Orders订单表已经进行分表操作了，和它关联的 orders_detail订单详情表如何进行join查询。</p>
<p>l  ER表</p>
<p>Mycat借鉴了 NewSQL领域的新秀 Foundation DB的设计思路， Foundation dB创新性的提出了 Table Group的概念，其将子表的存储位置依赖于主表，并且物理上紧邻存放，因此彻底解决了JoN的效率和性能问题，根据这一思路，提出了基于E-R关系的数据分片策略，子表的记录与所关联的父表记录存放在同一个数据分片上。</p>
<p>Ø 修改schema.xml配置文件</p>
<table name="orders" datanode="dn1, dn2" rule="mod rule">

<p>&lt;childTable name=”orders_detail” primaryKey=id” joinKey=”order_id” parentKey=”id”/&gt;</p>
</table>

<p>Ø 在dn2补充创建orders_detail表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image077.jpg" alt="img"></p>
<p>Ø 重启Mycat，进行ER关联测试</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image079.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image081.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p> 在Mycat进行orders和orders_datail表关联查询</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image083.jpg" alt="img"></p>
<h2 id="4-4-Mycat分片关联—全局表"><a href="#4-4-Mycat分片关联—全局表" class="headerlink" title="4-4. Mycat分片关联—全局表"></a>4-4. Mycat分片关联—全局表</h2><p>在分片的情况下，当业务表因为规模而进行分片以后，业务表与这些附属的字典表之间的关联就成了比较棘手的问题，考虑到字典表具有以下几个特性：</p>
<p>ü 变动不频繁</p>
<p>ü 数据量总体变化不大数据规模不大</p>
<p>ü 很少有超过数十万条记录</p>
<p>l  全局表</p>
<p>Ø 全局表的插入、更新操作会实时在所有节点上执行，保持各个分片的数据一致性</p>
<p>Ø 全局表的查询操作，只从一个节点获取</p>
<p>Ø 全局表可以跟任何一个表进行JOIN操作</p>
<p>将字典表或者符合字典表特性的一些表定义为全局表，则从另外一个方面，很好的解决了数据JOIN的难题。通过全局表+基于ER关系的分片策略， MyCAT可以满足80%以上的企业应用开发</p>
<p>Ø  修改schema.xml配置文件</p>
<table name="orders" datanode="dn1, dn2" rule="mod rule">

<p>&lt;childTable name=”orders_detail” primaryKey=id” joinKey=”order_id” parentKey=”id”/&gt;</p>
</table>

<table name="dict_order_type" datanode="”dn1," dn2" type="global"></table>

<p>Ø  在dn2补充创建字典表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image085.jpg" alt="img"></p>
<p>Ø  启动Mycat，验证全局表配置</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image087.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image089.jpg" alt="img"> <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image091.jpg" alt="img"></p>
<p>##在多个节点下，全局表数据是完整的</p>
<h2 id="4-5-Mycat常用分片规则"><a href="#4-5-Mycat常用分片规则" class="headerlink" title="4-5. Mycat常用分片规则"></a>4-5. Mycat常用分片规则</h2><p>l  取模</p>
<p>此规则为对分片字段求摸运算。也是水平分表最常用规则。5.2配置分表中，orders表采用了此规则</p>
<p>l  分片枚举</p>
<p>通过在配置文件中配置可能的枚举id，自己配置分片，本规则适用于特定的场景，比如有些业务需要按照省份或区县来做保存，而全国省份区县固定的，这类业务使用本条规则。</p>
<p>Ø  修改schema.xml和rule.xml配置文件</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image093.jpg" alt="img"></p>
<p># columns：分片字段， algorithm：分片函数</p>
<p># mapFile：：标识配置文件名称，type：0为int型、非0为 String，</p>
<p># default Node：默认节点：小于0表示不设置默认节点，大于等于0表示设置默认节点</p>
<p>#设置默认节点如果碰到不识别的枚举值，就让它路由到默认节点，如不设置不识别就报错</p>
<p>Ø  修改partition-bash-int.txt配置文件</p>
<p>110=0  //第一个数据节点</p>
<p>120=1  //第二个数据节点</p>
<p>Ø  访问Mycat创建表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image095.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image097.jpg" alt="img">)<img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image099.jpg" alt="img"></p>
<p>Ø  从Mycat插入不同归属区域的数据</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image101.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image103.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image105.jpg" alt="img">)<img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image107.jpg" alt="img"></p>
<p>l  范围约定</p>
<p>此分片适用于，提前规划好分片字段某个范围属于哪个分片。</p>
<p>Ø  修改schema.xml配置文件</p>
<table name="”payment_info"" datanode="”n1," dn2" rule="auto_sharding_long”></table>

<p>Ø  修改rule.xml文件</p>
<p><img src=" mycat%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0 clip_image109.gif" alt="img"><p></p>
<p># columns：分片字段，algorithm：分片函数# mapFile：标识配置文件名称</p>
<p>#defaultNode：默认节点:小于 0 表示不设置默认节点，大于等于 0 表示设置默认节点，</p>
<p>#设置默认节点如果碰到不识别的枚举值，就让它路由到默认节点，如不设置不识别就报错</p>
<p>Ø  修改autopartition-long.txt配置文件</p>
<p>0-102=0</p>
<p>103-200=1</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image111.gif" alt="img"></p>
<p>Ø  重启Mycat，创建测试表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image113.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image115.gif" alt="img">  <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image117.gif" alt="img"></p>
<p>Ø  插入测试数据，验证分片效果</p>
<p>INSERT INTO payment_info (id,order_id,payment_status) VALUES (1,101,0); </p>
<p>INSERT INTO payment_info (id,order_id,payment_status) VALUES (2,102,1); </p>
<p>INSERT INTO payment_info (id,order_id ,payment_status) VALUES (3,103,0); </p>
<p>INSERT INTO payment_info (id,order_id,payment_status) VALUES (4,104,1);</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image119.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image121.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image123.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image125.gif" alt="img"> </p>
<p>l  按日期（天）分片</p>
<p>此方式按天分片、设置时间格式、范围</p>
<p>Ø  修改schema.xml文件</p>
<table name="login_info datanode=”n1, n2” rule=”sharding_by_date”></table>

<p>Ø  修改rule.xml文件</p>
<tableRule name=" sharding_by_date">

<rule>

<p><columns>login_date</columns></p>
<p><algorithm>shardingByDate</algorithm></p>
</rule>



<p>…</p>
<function name="shardingByDate" class="io.mycat.route.function.PartitionByDate">

<p><property name="dateFormat">yyyy-MM-dd</property></p>
<p><property name="sBeginDate">2019-01-01</property></p>
<p>​         <property name="sEndDate">2019-01-04</property></p>
<p><property name="sPartionDay">2</property></p>
</function>

<p># columns：分片字段，algorithm：分片函数#dateFormat ：日期格式</p>
<p>#sBeginDate ：开始日期</p>
<p>#sEndDate：结束日期,则代表数据达到了这个日期的分片后循环从开始分片插入</p>
<p>##2019-01-01/02写入dn1 03/04写入dn2，但是如果不规定结束日期，启动Mycat会报错，因为05/06将写入dn3，但是现在没有dn3，规定了结束日期的话05/06会被写入dn1，后面的每两天一循环</p>
<p>#sPartionDay ：分区天数，即默认从开始日期算起，分隔 2 天一个分区</p>
<p>Ø  启动Mycat、创建测试表</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image127.gif" alt="img"></p>
<p>Ø  在Mycat插入数据，验证分片效果</p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (1,101,’2019-01-01’); </p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (2,102,’2019-01-02’); </p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (3,103,’2019-01-03’); </p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (4,104,’2019-01-04’); </p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (5,103,’2019-01-05’); </p>
<p>INSERT INTO login_info(id,user_id,login_date) VALUES (6,104,’2019-01-06’);</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image129.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image131.gif" alt="img">  <img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image133.gif" alt="img"></p>
<h2 id="4-6-Mycat水平分片全局序列"><a href="#4-6-Mycat水平分片全局序列" class="headerlink" title="4-6. Mycat水平分片全局序列"></a>4-6. Mycat水平分片全局序列</h2><p>   在实现分库分表的情况下，数据库自增主键已无法保证自增主键的全局唯一。为此，Mycat 提供了全局 sequence，并且提供了包含本地配置和数据库配置等多种实现方式</p>
<p>l  本地文件</p>
<p>  此方式 Mycat 将 sequence 配置到文件中，当使用到 sequence 中的配置后，Mycat 会更下classpath 中的 sequence_conf.properties 文件中 sequence 当前的值。</p>
<p>①   优点：本地加载，读取速度较快</p>
<p>②   缺点：抗风险能力差，Mycat 所在主机宕机后，无法读取本地文件。</p>
<p>l  数据库方式</p>
<p>  利用数据库一个表 来进行计数累加。但是并不是每次生成序列都读写数据库，这样效率太低。</p>
<p>  Mycat 会预加载一部分号段（例如100）到 Mycat 的内存中，这样大部分读写序列都是在内存中完成的。如果内存中的号段用完了 Mycat 会再向数据库要一次。</p>
<p>²  问：那如果Mycat 崩溃了 ，那内存中的序列岂不是都没了？</p>
<p>  是的。如果是这样，那么Mycat 启动后会向数据库申请新的号段，原有号段会弃用。</p>
<p>也就是说如果 Mycat 重启，那么损失是当前的号段没用完的号码，但是不会因此出现主键重复</p>
<p>Ø  创建全局序列表</p>
<blockquote>
<blockquote>
<p> 在 dn1 上创建全局序列表</p>
</blockquote>
</blockquote>
<p>CREATE TABLE MYCAT_SEQUENCE (NAME VARCHAR(50) NOT NULL,current_value INT NOT NULL,increment INT NOT NULL DEFAULT 100, PRIMARY KEY(NAME)) ENGINE=INNODB;</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image135.gif" alt="img"></p>
<blockquote>
<blockquote>
<p> 创建全局序列函数</p>
</blockquote>
</blockquote>
<p>DELIMITER $$</p>
<p>CREATE FUNCTION mycat_seq_currval(seq_name VARCHAR(50)) RETURNS VARCHAR(64) DETERMINISTIC</p>
<p>BEGIN</p>
<p>DECLARE retval VARCHAR(64);</p>
<p>SET retval=”-999999999,null”;</p>
<p>SELECT CONCAT(CAST(current_value AS CHAR),”,”,CAST(increment AS CHAR)) INTO retval FROM MYCAT_SEQUENCE WHERE NAME = seq_name;</p>
<p>RETURN retval; END $$ DELIMITER</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image137.gif" alt="img"></p>
<p>DELIMITER $$</p>
<p>CREATE FUNCTION mycat_seq_setval(seq_name VARCHAR(50),VALUE INTEGER) RETURNS VARCHAR(64)</p>
<p>DETERMINISTIC BEGIN</p>
<p>UPDATE MYCAT_SEQUENCE</p>
<p>SET current_value = VALUE WHERE NAME = seq_name;</p>
<p>RETURN mycat_seq_currval(seq_name); END $$</p>
<p>DELIMITER ;</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image139.gif" alt="img"></p>
<p>DELIMITER $$</p>
<p>CREATE FUNCTION mycat_seq_nextval(seq_name VARCHAR(50)) RETURNS VARCHAR(64) DETERMINISTIC</p>
<p>BEGIN</p>
<p>UPDATE MYCAT_SEQUENCE</p>
<p>SET current_value = current_value + increment WHERE NAME = seq_name; RETURN mycat_seq_currval(seq_name);</p>
<p>END $$ DELIMITER ;</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image141.gif" alt="img"></p>
<blockquote>
<blockquote>
<p> 初始化序列表记录</p>
</blockquote>
</blockquote>
<p>INSERT INTO MYCAT_SEQUENCE(NAME,current_value,increment) VALUES (‘ORDERS’, 400000, 100);</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image143.jpg" alt="img"></p>
<p>Ø  修改Mycat配置</p>
<blockquote>
<blockquote>
<p> 修改sequence_db_conf.properties</p>
</blockquote>
</blockquote>
<p>vim sequence_db_conf.properties</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image145.jpg" alt="graphic">                       </p>
<p>#意思是 ORDERS这个序列在dn1这个节点上，具体dn1节点是哪台机子，请参考schema.xml</p>
<blockquote>
<blockquote>
<p> 修改server.xml vim server.xml</p>
</blockquote>
</blockquote>
<p>#全局序列类型：0-本地文件，1-数据库方式，2-时间戳方式。此处应该修改成1。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image147.jpg" alt="graphic"></p>
<p>Ø  重启Mycat、验证全局序列</p>
<p>insert into orders(id,amount,customer_id,order_type) values(next value for MYCATSEQ_ORDERS,1000,101,102);</p>
<p>insert into orders(id,amount,customer_id,order_type) values(next value for MYCATSEQ_ORDERS,1000,101,102);</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image149.gif" alt="img"></p>
<blockquote>
<blockquote>
<p> 模拟Mycat故障、重启Mycat再次插入数据查询</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image151.gif" alt="img"></p>
<p>l  时间戳方式</p>
<p>  全局序列ID= 64 位二进制 (42(毫秒)+5(机器 ID)+5(业务编码)+12(重复累加) 换算成十进制为 18 位数的</p>
<p>long 类型，每毫秒可以并发 12 位二进制的累加。</p>
<p>①优点：配置简单</p>
<p>②缺点：18 位 ID 过长</p>
<h1 id="第五节：基于HA机制的Mycat高可用"><a href="#第五节：基于HA机制的Mycat高可用" class="headerlink" title="第五节：基于HA机制的Mycat高可用"></a>第五节：基于HA机制的Mycat高可用</h1><p>在实际项目中，Mycat 服务也需要考虑高可用性，如果 Mycat 所在服务器出现机，或 Mycat服务故障，需要有备机提供服务，需要考虑 Mycat 集群。</p>
<h2 id="5-1-高可用方案HAporxy-Keepalived"><a href="#5-1-高可用方案HAporxy-Keepalived" class="headerlink" title="5-1. 高可用方案HAporxy+Keepalived"></a>5-1. 高可用方案HAporxy+Keepalived</h2><p>我们可以使用 Haproxy+ Keepalived 配合两台 Mycat 搭起 Mycat 集群，实现高可用性。Haproxy 实现了 Mycat 多节点的集群高可用和负载均衡。</p>
<p>而 Haproxy 自身的高可用则可以通过 Keepalived 来实现。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image153.gif" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image155.gif" alt="img"></p>
<p>##HAproxy保障Mycat高可用及负载均衡、Keepalived保障HAProxy的高可用性</p>
<p>l  安装配置HAProxy</p>
<p>Ø  下载并解压至/usr/local/src</p>
<p>tar-zxvf haproxy-15 18. tar. gz -C /usr/local/src</p>
<p>Ø  进入解压后目录，查看内核版本，进行编译安装</p>
<p>cd /usr/local/src/haproxy-1.5.18</p>
<p>uname -r</p>
<p>make TARGET=linux310 PREFIX=/usr/localhaproxy ARCH=x86_64</p>
<p># ARGEt= linux310，内核版本，使用 uname -r查看内核，如：3.10.0-514.el7，此时该参数就为linux310</p>
<p>#ARCH=x8664:系统位数；</p>
<p>#PREFIX=/ usr/localhaprpxy# usr/local/haprpxy，为 HAPrpxy安装路径</p>
<p>make install PREFIX=/usr/local haproxy</p>
<p>Ø  安装完成后，创建目录、创建 HAProxy配置文件</p>
<p>mkdir -p /usr/data/haproxy/+</p>
<p>vim /usr/local haproxy/haproxy. conf.</p>
<blockquote>
<blockquote>
<p>创建HAProxy配置文件</p>
</blockquote>
</blockquote>
<p>globale </p>
<p>log 127.0.0.1 local0</p>
<p>#log 127.0.0. 1 locall notice J</p>
<p>#log loghost local0 info maxconn 4096.</p>
<p>chroot /usr/local/haproxy,</p>
<p>pidfile /usr/data/haproxy/haproxy.pid </p>
<p>uid 99.</p>
<p>gid 99</p>
<p>daemon.</p>
<p>#debug</p>
<p>#quiet</p>
<p>defaults</p>
<p>  log   global</p>
<p>mode   tcp </p>
<p>option  abortonclose.</p>
<p>option  redispatch </p>
<p>retries 3.</p>
<p>maxconn 2000.</p>
<p>timeout connect 5000</p>
<p>timeout client 50000</p>
<p>timeout server 50000</p>
<p>listen_proxy_status </p>
<p>bind：48066</p>
<p>mode tcp.</p>
<p>balance roundrobin.</p>
<p>server mycat_1 192. 168. 140. 128:8066 check inter 10s</p>
<p>server mycat_2 192. 168. 140. 127:8066 check inter 10s</p>
<p>frontend admin_stats </p>
<p>bind：7777.</p>
<p>mode http </p>
<p>stats enable.</p>
<p>option  httplog</p>
<p>maxconn  10.</p>
<p>stats refresh  30s.</p>
<p>stats uri /admin.</p>
<p>stats auth admin:123123.</p>
<p>stats hide-version.</p>
<p>stats admin if TRUE</p>
<p>Ø  启动HAProxy验证</p>
<blockquote>
<blockquote>
<p>启动 HAProxy</p>
</blockquote>
</blockquote>
<p>/usr/local/haproxy/sbin/haproxy -f/usr/local haproxy/haproxy. conf，</p>
<blockquote>
<blockquote>
<p>查看 HAProxy进程</p>
</blockquote>
</blockquote>
<p>ps - grep haproxy</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image157.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p>Web登录HAProxy查看mycat状态</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image159.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p>验证负载均衡、通过HAProxy访问Mycat</p>
</blockquote>
</blockquote>
<p>mysql –umycat -pl23456 –h 192.168.140.126（HA地址） –P 48066（HA提供业务端口）</p>
<p>l  安装配置Keepalive</p>
<p>Ø  安装Keepalive</p>
<blockquote>
<blockquote>
<p>下载并解压Keepalive</p>
</blockquote>
</blockquote>
<p>tar-zxvf keepalived-1.4. 2. tar.gz -C /usr/local/src</p>
<blockquote>
<blockquote>
<p>安装依赖环境</p>
</blockquote>
</blockquote>
<p>yum install-y gcc openssl-devel popt-devel</p>
<blockquote>
<blockquote>
<p>进入解压后目录，进行编译安装</p>
</blockquote>
</blockquote>
<p>cd /usr/local/src/keepalived-142.</p>
<p>./configure –prefix=/usr/local/keepalived</p>
<p>make &amp;&amp; make install</p>
<blockquote>
<blockquote>
<p>Keepalive运行前配置</p>
</blockquote>
</blockquote>
<p>cp /usr/local/src/keepalived-1.4.2/keepalived/etc/init.d/keepalived /etc/init.d/ mkdir/etc/keepalived</p>
<p>cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/ </p>
<p>cp /usr/local/src/keepalived-1.4.2/keepalived/etc/sysconfig/keepalived /etc/sysconfig/ </p>
<p>cp /usr/local/keepalived/sbin/keepalived /usr/sbin/</p>
<p>Ø  修改Keepalive配置文件</p>
<p>vim /etc/keepalived/keepalived.conf</p>
<blockquote>
<blockquote>
<p>修改内容如下：</p>
</blockquote>
</blockquote>
<p>Configuration File for keepalived</p>
<p>global_defs { </p>
<p>notification_email { </p>
<p><a href="mailto:xiaochen@foxmail.com">xiaochen@foxmail.com</a></p>
<p>   }</p>
<p>notification_email_from <a href="mailto:keepalived@showjoy.com">keepalived@showjoy.com</a></p>
<p>smtp server 127.0.0.1.</p>
<p>smtp_connect_timeout 30</p>
<p>router_id LVS_DEVEL.</p>
<p>vrrp_skip_check_adv_addr </p>
<p>vrrp_garp_interval 0.</p>
<p>vrrp_gna_interval 0</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image161.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image163.jpg" alt="img"></p>
<p>Ø  启动验证</p>
<blockquote>
<blockquote>
<p>启动Keepalive</p>
</blockquote>
</blockquote>
<p>systemctl start keepalived</p>
<blockquote>
<blockquote>
<p>登录验证</p>
</blockquote>
</blockquote>
<p>mysql -umycat -p123456 -h192.168.140.200（Keepalive地址） -P48066</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image165.jpg" alt="img"></p>
<p>l  高可用状态验证</p>
<p>Ø  手动停止其中一台Mycat</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image167.jpg" alt="img"></p>
<h1 id="第六节：Mycat安全设置"><a href="#第六节：Mycat安全设置" class="headerlink" title="第六节：Mycat安全设置"></a>第六节：Mycat安全设置</h1><h2 id="6-1-Mycat权限配置"><a href="#6-1-Mycat权限配置" class="headerlink" title="6-1. Mycat权限配置"></a>6-1. Mycat权限配置</h2><p>l  User标签权限配置</p>
<p>目前 Mycat对于中间件的连接控制并没有做太复杂的控制，目前只做了中间件逻辑库级别的读写权限控制。是通过 server xml的user标签进行配置。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image169.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image171.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image173.jpg" alt="img"></p>
<p>l  privileges标签权限控制</p>
<p>在user标签下的 privileges标签可以对逻辑库（ schema）、表（ table）进行精细化的DML权限控制。</p>
<p>privileges标签下的 check属性，如为tne开启权限检查，为 false不开启，默认为 false。</p>
<p>由于 Mycat一个用户的 schemas属性可配置多个逻辑库（ schema），所以 privileges的下级节点 schema节点同样可配置多个，对多库多表进行细粒度的DML权限控制。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image175.jpg" alt="img"></p>
<p>Ø  配置说明</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image177.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image179.jpg" alt="img"></p>
<h2 id="6-1-Mycat对SQL拦截"><a href="#6-1-Mycat对SQL拦截" class="headerlink" title="6-1. Mycat对SQL拦截"></a>6-1. Mycat对SQL拦截</h2><p>firewall标签用来定义防火墙； firewall下 whitehost标签用来定义I白名单， blacklist用来定义SQL黑名单。</p>
<p>l  白名单</p>
<p>可以通过设置白名单，实现某主机用户可以访问Mycat，而其他主机不可以</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image181.jpg" alt="img"></p>
<p>Ø  重启Mycat进行登录验证</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image183.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image185.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image187.jpg" alt="img"></p>
<p>l  黑名单</p>
<p>可以通过设置黑名单，实现Mycat对具体SQL操作进行拦截，如增删改查等操作拦截</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image189.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image191.jpg" alt="img"></p>
<h1 id="第七节：Mycat监控平台"><a href="#第七节：Mycat监控平台" class="headerlink" title="第七节：Mycat监控平台"></a>第七节：Mycat监控平台</h1><h2 id="7-1-Mycat-Web监控功能实现"><a href="#7-1-Mycat-Web监控功能实现" class="headerlink" title="7-1. Mycat-Web监控功能实现"></a>7-1. Mycat-Web监控功能实现</h2><p>Mycat-web是 Mycat可视化运维的管理和监控平台，弥补了 Mycat在监控上的空白。帮 Mycat分担统计任务和配置管理任务。 Mycat-web引入了 ZooKeeper作为配置中心，可以管理多个节点。</p>
<p>Mycat-web主要管理和监控 Mycat的流量、连接、活动线程和内存等，具备白名单、邮件告警等模块，还可以统计SQL并分析慢SQL和高频SQL等。为优化SQL提供依据。</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image193.jpg" alt="img"></p>
<p>l  ZooKeeper+Mycat-web部署</p>
<p>Ø  ZooKeeper部署</p>
<blockquote>
<blockquote>
<p>下载解压ZooKeeper</p>
</blockquote>
</blockquote>
<p>下载安装包<a href="http://zookeeper" target="_blank" rel="noopener">http://zookeeper</a>. apache. org/</p>
<p>解压缩：tar-zxvf zookeeper-34 11. tar.gz</p>
<blockquote>
<blockquote>
<p>拷贝解压后目录至自建目录中</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image195.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p>复制ZooKeeper配置文件并改名</p>
</blockquote>
</blockquote>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image197.jpg" alt="img"></p>
<blockquote>
<blockquote>
<p>启动ZooKeeper</p>
</blockquote>
</blockquote>
<p>ZooKeeper/bin/zkServer.sh start</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image199.jpg" alt="img"></p>
<p>Ø  Mycat-web安装</p>
<blockquote>
<blockquote>
<p>下载并解压</p>
</blockquote>
</blockquote>
<p>下载安装包<a href="http://www.mycat.io/" target="_blank" rel="noopener">http://www.mycat.io/</a></p>
<p>tar-zxvf Mycat-web-1.0-SNAPSHOT-20170102153329-linux. tar.gz</p>
<blockquote>
<blockquote>
<p>拷贝并启动</p>
</blockquote>
</blockquote>
<p>cp -r mycat-web/usr/loca</p>
<p>cd /usr/local/ mycat-web</p>
<p>/start. sh &amp;</p>
<p>Mycat-web服务端口为8082，查看服务已经启动</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image201.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image203.jpg" alt="img"></p>
<p>Ø  配置Mycat</p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image205.jpg" alt="img"></p>
<p><img src="/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image207.jpg" alt="img"></p>
</table></table>
    </div>

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>晓晨
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2020/06/02/Mycat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Mycat学习笔记">http://yoursite.com/2020/06/02/Mycat学习笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/01/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="Mysql学习笔记">
      <i class="fa fa-chevron-left"></i> Mysql学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/02/Ansible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="Ansible学习笔记">
      Ansible学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一节：Mycat基础"><span class="nav-number">1.</span> <span class="nav-text">第一节：Mycat基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Mycat作用"><span class="nav-number">1.1.</span> <span class="nav-text">1.        Mycat作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Mycat原理"><span class="nav-number">1.2.</span> <span class="nav-text">1.        Mycat原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Mycat部署"><span class="nav-number">1.3.</span> <span class="nav-text">1.        Mycat部署</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二节：Mycat读写分离"><span class="nav-number">2.</span> <span class="nav-text">第二节：Mycat读写分离</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-一主一从MySQL读写分离"><span class="nav-number">2.1.</span> <span class="nav-text">2-1. 一主一从MySQL读写分离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-多主多从MySQL读写分离"><span class="nav-number">2.2.</span> <span class="nav-text">2-2. 多主多从MySQL读写分离</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第三节：垂直拆分——分库"><span class="nav-number">3.</span> <span class="nav-text">第三节：垂直拆分——分库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第四节：水平拆分——分表"><span class="nav-number">4.</span> <span class="nav-text">第四节：水平拆分——分表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-水平分表划分原则"><span class="nav-number">4.1.</span> <span class="nav-text">4-1. 水平分表划分原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-水平分表配置"><span class="nav-number">4.2.</span> <span class="nav-text">4-2. 水平分表配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-Mycat分片关联—ER表"><span class="nav-number">4.3.</span> <span class="nav-text">4-3. Mycat分片关联—ER表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-Mycat分片关联—全局表"><span class="nav-number">4.4.</span> <span class="nav-text">4-4. Mycat分片关联—全局表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-Mycat常用分片规则"><span class="nav-number">4.5.</span> <span class="nav-text">4-5. Mycat常用分片规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-Mycat水平分片全局序列"><span class="nav-number">4.6.</span> <span class="nav-text">4-6. Mycat水平分片全局序列</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第五节：基于HA机制的Mycat高可用"><span class="nav-number">5.</span> <span class="nav-text">第五节：基于HA机制的Mycat高可用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-高可用方案HAporxy-Keepalived"><span class="nav-number">5.1.</span> <span class="nav-text">5-1. 高可用方案HAporxy+Keepalived</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第六节：Mycat安全设置"><span class="nav-number">6.</span> <span class="nav-text">第六节：Mycat安全设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Mycat权限配置"><span class="nav-number">6.1.</span> <span class="nav-text">6-1. Mycat权限配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Mycat对SQL拦截"><span class="nav-number">6.2.</span> <span class="nav-text">6-1. Mycat对SQL拦截</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第七节：Mycat监控平台"><span class="nav-number">7.</span> <span class="nav-text">第七节：Mycat监控平台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-Mycat-Web监控功能实现"><span class="nav-number">7.1.</span> <span class="nav-text">7-1. Mycat-Web监控功能实现</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="晓晨"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">晓晨</p>
  <div class="site-description" itemprop="description">乱世浮尘，不堪遥望，唯有情意，晨光依旧</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <script src="https://soyawww.github.io/live2d/autoload.js"></script>
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">晓晨</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
